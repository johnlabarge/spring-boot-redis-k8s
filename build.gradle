buildscript {
    repositories {
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.4.2.RELEASE")
        classpath('se.transmode.gradle:gradle-docker:1.2')
    }
}

apply plugin: 'groovy'


apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'org.springframework.boot'
apply plugin: 'docker'

jar {
    baseName = 'spring-boot-app'
    version  = '0.1.0'
}
group = "gcr.io/cloudjlb-eventer"


task buildDocker(type: Docker, dependsOn: build) {
    push = false
    applicationName = jar.baseName
    tag = "${project.group}/${applicationName}"
    tagVersion=null
    dockerfile = file('src/main/docker/Dockerfile')
    doFirst {
        copy {
            from jar
            into stageDir
        }
    }
}

task deployDockerToGCP(type: Exec, dependsOn: buildDocker) {

    commandLine "gcloud","docker","--","push", "${buildDocker.tag}"
}
task feDocker(type: Docker) {
    push = false
    tag = "${project.group}/web-frontend"
    dockerfile = file('web-frontend/eventer/Dockerfile')
    doFirst {
        println "DO FIRST##########"
        copy {
            println "copy-----"
            from file("web-frontend/eventer/dist")
            into file(stageDir.getPath()+'/dist')
        }
        copy {
            from file("web-frontend/eventer/nginx.conf")
            into stageDir
        }
    }
}
task deployFe(type: Exec, dependsOn: feDocker) {
    commandLine "gcloud", "docker", "--", "push",  "${feDocker.tag}"
}

task deployment
repositories {
    mavenCentral()
}
targetCompatibility = 1.8
sourceCompatibility = 1.8
dependencies {
    compile "org.springframework.boot:spring-boot-starter-web"
    compile "org.springframework.boot:spring-boot-starter-actuator"
    compile "se.transmode.gradle:gradle-docker:1.2"
    //compile "org.springframework.boot:spring-boot-starter-security"
    //compile "com.google.firebase:firebase-admin:4.0.3"
    compile group: 'com.google.cloud', name: 'google-cloud-datastore', version: '0.8.0-beta'
    testCompile("org.springframework.boot:spring-boot-starter-test")
    testCompile group: 'junit', name: 'junit', version: '4.11'
}

